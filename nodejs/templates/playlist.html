{% extends 'base_listener.html' %}
{% block page %}
<!-- Main Container To Display The Album Details and Songs-->
<div class="main_container">
    <div class="album">
        <img src="/playlist/{{ data.playlist['PlaylistID'] }}/pic" alt="playlist picture">
        <div class="album_information">
            <h1>{{ data.playlist['PlaylistName'] }}</h1>
            <div>
                <ul class="album_data">
                    <li>
                        <h4>{{ data.username }}</h4>
                    </li>
                    <li>
                        <h4><!--{{ data.playlist_duration }} --></h4>
                    </li>
                </ul>
            </div>
        </div>
    </div>

    <!-- List of Songs, Needs A Loop to Create the List Instead of Listing Them Manually -->
    <div class="album_songs">
        <div class="album_header">
            <ul>
                <div class="album_left_info">
                    <li class="song_list_number">
                        <h4>#</h4>
                    </li>
                    <li>
                        <h4>Title</h4>
                    </li>
                </div>
                <div class="album_right_info">
                    <li>
                        <h4>Duration</h4>
                    </li>
                    <li>
                        <h4></h4>
                    </li>
                </div>
            </ul>
        </div>
        <hr>
        
        {% for song in data.songs %}
        <div class="track_list">
            <div class="track_info">
                <ul>
                    <div class="track_left_info">
                        <li class="song_list_number">
                            <h4>{{ song['Name'] }}</h4>
                        </li>
                        <li>
                            <a id='playSong' songid='{{ song[5] }}' href='#'><h4>{{ song[1] }}</h4></a>
                            <a href=""><h5>{{ song[2] }}</h5></a>
                        </li>
                    </div>
                    <div class="track_right_info">
                        <li>
                            <h4>{{ song[4] }}</h4>
                        </li>
                        <li>
                            <a><h4>-</h4></a>
                        </li>
                    </div>
                </ul>
            </div>
        </div>
        {% endfor %}

        <div class="song_list">
            <h2>Recommended</h2>
            <div class="list">
                {% for song in data.recommended %}
                <div class="item">
                    <a id='playSong' songid='{{ song['SongID'] }}' href='#'><img src="/album/{{ song['AlbumID'] }}/pic" alt="{{ song['Name'] }}"></a>
                    <h4>{{ song['Name'] }}</h4>
                    <a href='/artist/{{ song['ArtistID'] }}'><p>{{ song['ArtistName'] }}</p></a>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
</div>

<script>
function playSong(e) {
    e.preventDefault();

    let songid = this.getAttribute('songid');
    
    fetch('/song/'+songid)
        .then(response => response.json())
        .then(data => {
            let playerImage = document.getElementById('playerImage');
            let playerSong = document.getElementById('playerSong');
            let playerArtist = document.getElementById('playerArtist');
            let playerSource = document.getElementById('playerSource');

            playerImage.setAttribute('src', '/album/'+data['albumid']+'/pic');
            playerSong.innerHTML = data['songname'];
            playerArtist.innerHTML = data['artistname'];
        })
        .finally(() => {
            let playerSource = document.getElementById('playerSource');
            let playerAudio = document.getElementById('playerAudio');
            playerSource.setAttribute('src', '/song/'+songid+'/audio');
            playerAudio.load();
            playerAudio.play();
            let playerDiv = document.getElementById('playerDiv');
            playerDiv.style.display = '';
        })
        .catch(error => console.error('Error:', error));
}
addEventListener("DOMContentLoaded", (event) => {
    const playSongLinks = document.querySelectorAll('#playSong');
    for (var i = 0; i < playSongLinks.length; i++) {
        playSongLinks[i].addEventListener('click', playSong);
    }
});
</script>
{% endblock %}